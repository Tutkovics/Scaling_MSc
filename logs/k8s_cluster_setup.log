# Install helm
```
curl https://baltocdn.com/helm/signing.asc | sudo apt-key add -
sudo apt-get install apt-transport-https --yes
echo "deb https://baltocdn.com/helm/stable/debian/ all main" | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
sudo apt-get update
sudo apt-get install helm
helm version
version.BuildInfo{Version:"v3.5.3", GitCommit:"041ce5a2c17a58be0fcd5f5e16fb3e7e95fea622", GitTreeState:"dirty", GoVersion:"go1.15.8"}
```
# Install prometheus (https://www.fosstechnix.com/install-prometheus-and-grafana-on-kubernetes-using-helm/#1-install-helm-3-on-kubernetes-cluster)
```
kubectl create ns monitoring
helm repo add stable https://charts.helm.sh/stable
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install prometheus-stack prometheus-community/kube-prometheus-stack -n monitoring
W0414 17:20:30.919882   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:30.923977   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:30.927129   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:30.931088   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:30.934297   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:30.937194   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:30.939951   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:32.380206   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:33.504953   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:42.565333   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:42.702994   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:42.709174   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:42.712408   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:42.712883   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:42.713264   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:42.713416   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:42.715382   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:44.661140   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:45.866727   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
W0414 17:20:55.155562   32317 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+                     
NAME: prometheus-stack
LAST DEPLOYED: Wed Apr 14 17:20:27 2021
NAMESPACE: monitoring
STATUS: deployed
REVISION: 1
NOTES:
kube-prometheus-stack has been installed. Check its status by running:
  kubectl --namespace monitoring get pods -l "release=prometheus-stack"

Visit https://github.com/prometheus-operator/kube-prometheus for instructions on how to create & configure Alertmanager and Prometheus instances using the Operator.
```
# Edit Prometheus service to be nodeport 
```
kubectl edit svc -n monitoring prometheus-stack-kube-prom-prometheus 
...
  - name: web
    port: 9090
    protocol: TCP
    targetPort: 9090
    nodePort: 31090
  selector:
    app: prometheus
    prometheus: prometheus-stack-kube-prom-prometheus
  sessionAffinity: None
  type: NodePort
...
kubectl edit svc -n monitoring prometheus-stack-grafana
  - name: service
    port: 80
    protocol: TCP
    targetPort: 3000
    nodePort: 31030
  selector:
    app.kubernetes.io/instance: prometheus-stack
    app.kubernetes.io/name: grafana
  sessionAffinity: None
  type: NodePort
...
curl http://152.66.211.2:310<30/90>/graph --> works from everywhere
```
note:
- graphana user: admin
- graphana passwd: prom-operator
# Download git repo
# Install fortio
# install Go (https://golang.org/doc/install)
Run measurement


CompletedProcess(
  args='fortio load -qps 0 -t 60s -a -data-dir ../results/frontend-and-backend http://152.66.211.2:30000/to-backend?',
  returncode=0,
  stdout='', 
  stderr='Fortio 1.14.2 running at 0 queries per second, 4->4 procs, for 1m0s: http://152.66.211.2:30000/to-backend?\n22:13:00 I httprunner.go:81> Starting http test for http://152.66.211.2:30000/to-backend? with 4 thre
ads at -1.0 qps\nStarting at max qps with 4 thread(s) [gomax 4] for 1m0s\n22:14:01 I periodic.go:558> T001 ended after 1m0.111079555s : 112 calls. qps=1.863217244293925\n22:14:01 I periodic.go:558> T000 ended afte
r 1m0.202526835s : 146 calls. qps=2.4251473762911866\n22:14:01 I periodic.go:558> T003 ended after 1m0.30793492s : 118 calls. qps=1.9566247817394176\n22:14:01 I periodic.go:558> T002 ended after 1m0.307988631s : 1
26 calls. qps=2.089275448580165\nEnded after 1m0.308074793s : 502 calls. qps=8.3239\nAggregated Function Time : count 502 avg 0.47993398 +/- 0.2131 min 0.094629959 max 1.196331446 sum 240.92686\n# range, mid point
, percentile, count\n>= 0.09463 <= 0.1 , 0.097315 , 0.20, 1\n> 0.1 <= 0.12 , 0.11 , 1.39, 6\n> 0.12 <= 0.14 , 0.13 , 1.79, 2\n> 0.16 <= 0.18 , 0.17 , 1.99, 1\n> 0.18 <= 0.2 , 0.19 , 6.97, 25\n> 0.2 <= 0.25 , 0.225
 , 14.94, 40\n> 0.25 <= 0.3 , 0.275 , 23.71, 44\n> 0.3 <= 0.35 , 0.325 , 34.86, 56\n> 0.35 <= 0.4 , 0.375 , 41.43, 33\n> 0.4 <= 0.45 , 0.425 , 47.41, 30\n> 0.45 <= 0.5 , 0.475 , 55.18, 39\n> 0.5 <= 0.6 , 0.55 , 70
.32, 76\n> 0.6 <= 0.7 , 0.65 , 83.86, 68\n> 0.7 <= 0.8 , 0.75 , 92.43, 43\n> 0.8 <= 0.9 , 0.85 , 97.21, 24\n> 0.9 <= 1 , 0.95 , 98.41, 6\n> 1 <= 1.19633 , 1.09817 , 100.00, 8\n# target 50% 0.466667\n# target 75% 0
.634559\n# target 90% 0.771628\n# target 99% 1.07313\n# target 99.9% 1.18401\nSockets used: 4 (for perfect keepalive, would be 4)\nJitter: false\nCode 200 : 502 (100.0 %)\nResponse Header Sizes : count 502 avg 109
 +/- 0 min 109 max 109 sum 54718\nResponse Body/Total Sizes : count 502 avg 544.86653 +/- 0.3841 min 543 max 545 sum 273523\nAll done 502 calls (plus 4 warmup) 479.934 ms avg, 8.3 qps\nSuccessfully wrote 3720 byte
s of Json data to ../results/frontend-and-backend/2021-04-14-221301_152_66_211_2_30000_to_backend_dipterv1.json\n')